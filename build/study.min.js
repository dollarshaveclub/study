/**
  studyjs - A client side A/B tester
  @version v5.0.2
  @link https://github.com/dollarshaveclub/study
  @author Jacob Kelley <jacob.kelley@dollarshaveclub.com>
  @license MIT
**/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Study=t()}(this,function(){"use strict";var s,t=function(e,t){if(e.length!==t.length)throw new Error("names and weights must have equal length!");for(var s,n,r=t.reduce(function(e,t){return e+t},0),i=0,o=(s=0,n=r,Math.random()*(n-s)+s),u=0;u<e.length;u++)if(o<=(i+=t[u]))return e[u];return e[e.length-1]},c=function(s){var e=Object.keys(s.buckets),n=[];return e.forEach(function(e){var t=s.buckets[e].weight;null==t&&(t=1),n.push(t)}),t(e,n)},e=function(){function e(e){void 0===e&&(e={}),Object.assign(this,{storageKey:"ab-tests",root:"undefined"!=typeof document?document.body:null},e),function(e){if(!e)throw new Error("You must supply a store!");if("function"!=typeof e.get)throw new Error("The store must implement .get()");if("function"!=typeof e.set)throw new Error("The store must implement .set()");if("function"!=typeof e.isSupported)throw new Error("The store must implement .isSupported()");if(!e.isSupported())throw new Error("The store is not supported.")}(this.store),this.previousAssignments={};try{var t=this.store.get(this.storageKey);"string"==typeof t&&"{"===t[0]&&(this.previousAssignments=JSON.parse(t))}catch(e){}this.userAssignments={},this.persistedUserAssignments={},this.providedTests=[]}var t=e.prototype;return t.define=function(e){var t=this,s=e;Array.isArray(e)||(s=[e]),s.forEach(function(e){if(!e.name)throw new Error("Tests must have a name");if(!e.buckets)throw new Error("Tests must have buckets");if(!Object.keys(e.buckets))throw new Error("Tests must have buckets");t.providedTests.push(e)})},t.definitions=function(){return this.providedTests},t.removeClasses=function(t,s){var n=this.root;n&&n.className.split(/\s+/g).map(function(e){return e.trim()}).filter(Boolean).filter(function(e){return 0===e.indexOf(t+"--")}).filter(function(e){return e!==s}).forEach(function(e){return n.classList.remove(e)})},t.applyClasses=function(){var n=this,r=this.userAssignments,i=this.root;i&&Object.keys(r).forEach(function(e){var t=r[e],s=t?e+"--"+t:null;n.removeClasses(e,s),s&&i.classList.add(s)})},t.assignAll=function(){var o=this.previousAssignments,u=this.userAssignments,a=this.persistedUserAssignments;this.providedTests.forEach(function(t){var e=Object.keys(t.buckets).filter(function(e){return t.buckets[e].winner})[0];if(e)u[t.name]=e;else if(!u[t.name]){var s=o[t.name];if(s&&t.buckets[s]){var n=o[t.name];return a[t.name]=n,u[t.name]=n,void(t.active=!0)}if(!1!==t.active){var r,i=c(t);a[t.name]=i,u[t.name]=i}else u[t.name]=(r=t.buckets,Object.keys(r).filter(function(e){var t=r[e];return t.default||t.winner})[0]||Object.keys(r)[0])}}),this.persist(),this.applyClasses()},t.assign=function(t,e){if(!t)return this.assignAll();var s=this.providedTests.filter(function(e){return e.name===t})[0];if(null===e||!s)return delete this.userAssignments[t],delete this.persistedUserAssignments[t],this.persist(),void this.removeClasses(t);var n=e||c(s);this.userAssignments[t]=n,this.persistedUserAssignments[t]=n,s.active=!0,this.persist(),this.applyClasses()},t.extendAssignments=function(e){return e},t.assignments=function(){return this.extendAssignments(this.userAssignments)},t.persist=function(){this.store.set(this.storageKey,JSON.stringify(this.persistedUserAssignments))},e}(),n={browserCookie:{type:"browserCookie",get:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},set:function(e,t){var s=new Date("12/31/9999").toUTCString();document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+"; expires="+s+"; path=/"},isSupported:function(){return"undefined"!=typeof document}},local:{type:"local",get:function(e){return localStorage.getItem(e)},set:function(e,t){return localStorage.setItem(e,t)},isSupported:function(){if("undefined"!=typeof localStorage)return!0;var e=new Date;try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}},memory:(s=Object.create(null),{type:"memory",get:function(e){return s[e]},set:function(e,t){s[e]=t},isSupported:function(){return!0}})};return(window.Study=e).stores=n,e});
