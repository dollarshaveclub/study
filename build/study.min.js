/**
 * studyjs - A client side A/B tester
 * @version v2.1.1
 * @link https://github.com/dollarshaveclub/study
 * @author Jacob Kelley <jacob.kelley@dollarshaveclub.com>
 * @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Study=t()}(this,function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),n=!("undefined"==typeof module||!module.exports),s="ab-tests",r=function(e,t){return Math.random()*(t-e)+e},o=function(e,t){for(var n=t.reduce(function(e,t){return e+t}),s=0,o=r(0,n),i=0;i<e.length;i+=1)if(s+=t[i],o<=s)return e[i];return""},i=function(e){return 1===e.length?e[0]:e},u=function(){function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.store,o=void 0===n?r.stores.local:n;e(this,r),this.store=o,this.store.isSupported()||(console.warn("Provided store '"+o.type+"' is not supported. Falling back to 'memory' store"),this.store=r.stores.memory),this.userBuckets={},this.userAssignments={},this.providedTests=[],this.classList={};var i=this.store.get(s);if(i)try{this.userBuckets=JSON.parse(i)}catch(e){this.userBuckets={}}}return t(r,[{key:"define",value:function(e){var t=this,n=e;Array.isArray(e)||(n=[e]),n.forEach(function(e){if(!e.name)throw new Error("Tests must have a name");if(!e.buckets)throw new Error("Tests must have buckets");if(!Object.keys(e.buckets))throw new Error("Tests must have buckets");t.providedTests=t.providedTests.concat(e)})}},{key:"definitions",value:function(){return i(this.providedTests)}},{key:"assign",value:function(e,t){var s=this,r=this.assignments(),i=function e(){Object.keys(s.classList).forEach(function(e){s.classList[e]?document.body.classList.add(e+"--"+s.classList[e]):document.body.classList.remove(e+"--"+r[e])}),document.removeEventListener("DOMContentLoaded",e)};this.providedTests.forEach(function(n){var r=n.name in s.userBuckets,i=t&&e&&e===n.name,u=e&&n.name!==e,c=null===t,a=void 0;if(!u){if(c)a=t;else if(i)a=t;else if(r)a=s.userBuckets[n.name];else{var f=Object.keys(n.buckets),d=[];f.forEach(function(e){var t=n.buckets[e].weight;void 0===t&&(t=1),d.push(t)}),a=o(f,d)}c?(s.classList[n.name]=null,delete s.userAssignments[n.name]):(s.classList[n.name]=a,s.userAssignments[n.name]=a)}}),!n&&document.body?i():document.addEventListener("DOMContentLoaded",i),this.persist(this.userAssignments)}},{key:"assignments",value:function(){return this.userAssignments}},{key:"persist",value:function(e){this.store.set(s,JSON.stringify(e))}}]),r}();return u.stores={local:{type:"local",get:function(e){return localStorage.getItem(e)},set:function(e,t){return localStorage.setItem(e,t)},isSupported:function(){if("undefined"!=typeof localStorage)return!0;var e=new Date;try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}},memory:function(){var e={};return{type:"memory",get:function(t){return e[t]},set:function(t,n){e[t]=n},isSupported:function(){return!0}}}(),browserCookie:{type:"browserCookie",get:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},set:function(e,t){return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+"; expires=expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/"},isSupported:function(){return!n}}},u});
